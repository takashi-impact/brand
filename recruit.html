<!DOCTYPE html>
<html lang="ja">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://impact.msademo.net https://*.referralsaasquatch.com https://cdnjs.cloudflare.com; connect-src 'self' https://*.referralsaasquatch.com https://*.impact.com; frame-src 'self' https://*.referralsaasquatch.com; img-src 'self' data: https://*.referralsaasquatch.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;">
<!-- Advocate -->
<script type="text/javascript"> 
    (function(a,b,c,d,e,f,g){e['ire_o']=c;e[c]=e[c]||function(){(e[c].a=e[c].a||[]).push(arguments)};f=d.createElement(b);g=d.getElementsByTagName(b)[0];f.async=1;f.src=a;g.parentNode.insertBefore(f,g);})('https://impact.msademo.net/A6108791-de00-46db-9400-014533654bf765535.js','script','ire',document,window); 
    ire('identify', {customerid: '' /*INSERT CUSTOMER ID*/, customeremail: '' /*INSERT SHA1 HASHED CUSTOMER EMAIL*/});
  </script>
  
  <script>
      // JWTを受け取ってImpactの処理を実行するメイン関数
      function runImpactProcess(inputJwt) {
          if (!inputJwt) {
              console.error("JWTが入力されませんでした。");
              return;
          }
  
          const timestamp = new Date().getTime();
          const id = `user${timestamp}@example.com`; 
          const accountId = `user${timestamp}@example.com`; 
          const email = `user${timestamp}@example.com`; 
  
          console.log("Using User ID:", id);
          console.log("Using JWT:", inputJwt);
  
          // referralCookieの取得（既存ロジック）
          impact.api().referralCookie().then(function (response) {
              const waitForElement = setInterval(function () {
                  const el = document.getElementsByName("impact_referralcookies");
                  if (el.length) {
                      clearInterval(waitForElement);
                      el[0].value = response.encodedCookie;
                  }
              }, 100);
          });
  
          const userConfig = {
              user: {                               
                  id: id,                      
                  accountId: accountId,       
                  email: email,               
              },
              jwt: inputJwt // 入力されたJWTを使用
          };
  
          // upsertUserの実行
          impact.api().upsertUser(userConfig).then(function(response) {
              console.log("Upsert Success:", response);
              alert("成功しました！ウィジェットが表示されるか確認してください。");
          }).catch(function(error){
              console.error("Upsert Error:", error);
              alert("エラーが発生しました。詳細はコンソールを確認してください。");
          });
      }
  
      // Impactライブラリの準備ができたら呼び出される
      window.impactOnReady = function () {
          console.log("Impact is ready. Waiting for user input...");
          
          // ボタンなどから呼び出すためのデバッグ用。自動でポップアップを出したい場合は以下を有効化。
          const userJwt = window.prompt("JWT(ioなどで生成したトークン)を入力してください:");
          runImpactProcess(userJwt);
      };
  </script>
<!-- /Advocate -->
      

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>ケーキショップ向け 無料ホームページテンプレート tp_cute2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="ここにサイト説明を入れます">
<meta name="keywords" content="キーワード１,キーワード２,キーワード３,キーワード４,キーワード５">
<link rel="stylesheet" href="css/style.css">
<script src="js/openclose.js"></script>
<script src="js/fixmenu_pagetop.js"></script>

<!-- toaster -->
<!-- https://phiary.me/toastr-usage/ -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet" />
<script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<!-- /toaster -->
<!-- Load tags.html -->
<!-- <script>
    $(function(){
        $.get('tags.html',function(data){
            $("body").append(data);
        });
    });
</script> -->
<!-- Load tags.html -->

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>

<div id="container">

<header>
<h1 id="logo"><a href="index.html"><img src="images/logo2.png" alt="Macaroon Shop"></a></h1>
<h2>RECRUIT<span>お友達紹介</span></h2>
<!--PC用（901px以上端末）メニュー-->
<nav id="menubar">
<ul>
<li><a href="index.html"><span>Home</span><span>ホーム</span></a></li>
<li><a href="about.html"><span>About</span><span>ショップについて</span></a></li>
<li><a href="menu.html"><span>Macarron</span><span>マカロンメニュー</span></a></li>
<li><a href="access.html"><span>Access</span><span>アクセス</span></a></li>
<li><a href="recruit.html"><span>Recruit</span><span>お友達紹介</span></a></li>
</ul>
<ul class="icon">
<li><a href="#"><img src="images/icon_facebook.png" alt="Facebook"></a></li>
<li><a href="#"><img src="images/icon_twitter.png" alt="Twitter"></a></li>
<li><a href="#"><img src="images/icon_instagram.png" alt="Instagram"></a></li>
<li><a href="#"><img src="images/icon_youtube.png" alt="YouTube"></a></li>
<li><a href="#"><img src="images/icon_line.png" alt="LINE"></a></li>
</ul>
</nav>
</header>

<!--小さな端末用（900px以下端末）ブロック-->
<nav id="menubar-s">
<ul>
<li><a href="index.html"><span>Home</span><span>ホーム</span></a></li>
<li><a href="about.html"><span>About</span><span>ショップについて</span></a></li>
<li><a href="menu.html"><span>Macarron</span><span>マカロンメニュー</span></a></li>
<li><a href="access.html"><span>Access</span><span>アクセス</span></a></li>
<li><a href="recruit.html"><span>Recruit</span><span>お友達紹介</span></a></li>
</ul>
<ul class="icon">
<li><a href="#"><img src="images/icon_facebook.png" alt="Facebook"></a></li>
<li><a href="#"><img src="images/icon_twitter.png" alt="Twitter"></a></li>
<li><a href="#"><img src="images/icon_instagram.png" alt="Instagram"></a></li>
<li><a href="#"><img src="images/icon_youtube.png" alt="YouTube"></a></li>
<li><a href="#"><img src="images/icon_line.png" alt="LINE"></a></li>
</ul>
</nav>

<div id="main">

<section>

<h2>お友達紹介</h2>
<!-- <impact-popup widget="w/demo-widget-1"><button>Click me!</button></impact-popup> -->
<impact-embed widget="w/demo-widget-1"><div>Loading...</div></impact-embed>
<!--/#main-->

<footer>
<small>Copyright&copy; <a href="index.html">Macaroon Shop</a> All Rights Reserved.</small>
<span class="pr"><a href="https://template-party.com/" target="_blank">《Web Design:Template-Party》</a></span>
</footer>

</div>
<!--/#container-->

<!--ページの上部に戻るボタン-->
<p class="nav-fix-pos-pagetop"><a href="#"><img src="images/icon_pagetop.png" alt="↑"></a></p>

<!--メニュー開閉ボタン-->
<div id="menubar_hdr" class="close"></div>

<!--メニューの開閉処理-->
<script>
open_close("menubar_hdr", "menubar-s");
</script>

</body>
</html>
